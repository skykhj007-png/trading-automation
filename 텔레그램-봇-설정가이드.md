# 텔레그램 봇 설정 가이드

## 1. 텔레그램 봇 생성

### 1-1. BotFather에서 봇 만들기

1. 텔레그램 앱에서 **@BotFather** 검색
2. `/start` 입력
3. `/newbot` 입력
4. 봇 이름 입력 (예: `클로드25 트레이딩봇`)
5. 봇 유저네임 입력 (예: `claude25_trading_bot`) - 반드시 `_bot`으로 끝나야 함
6. **봇 토큰** 복사해두기

```
예시 토큰:
7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw
```

---

## 2. Chat ID 얻기

### 2-1. userinfobot 사용

1. 텔레그램에서 **@userinfobot** 검색
2. `/start` 입력
3. **Id** 값 복사 (숫자)

```
예시 Chat ID:
123456789
```

### 2-2. 또는 직접 확인

1. 방금 만든 봇에게 아무 메시지 전송
2. 브라우저에서 접속:
```
https://api.telegram.org/bot{봇토큰}/getUpdates
```
3. JSON에서 `"chat":{"id":123456789}` 찾기

---

## 3. Code.gs 설정

### 3-1. 토큰 입력

Code.gs 파일 상단의 `TELEGRAM_CONFIG` 찾아서 수정:

```javascript
var TELEGRAM_CONFIG = {
  BOT_TOKEN: '7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw',  // ← 여기에 봇 토큰
  CHAT_ID: '123456789'  // ← 여기에 Chat ID
};
```

### 3-2. 앱스크립트 배포

1. Google Apps Script 열기
2. Code.gs 저장
3. **배포** → **새 배포**
4. 유형: 웹 앱
5. 실행 권한: 나
6. 액세스: 모든 사용자
7. **배포** 클릭
8. 새 URL 복사

---

## 4. 웹훅 설정

### 4-1. 웹훅 등록

1. 앱스크립트에서 `setupTelegramWebhook` 함수 실행
2. 로그 확인: "Telegram 웹훅 설정 완료" 메시지

### 4-2. 수동 등록 (위가 안될 경우)

브라우저에서 접속:
```
https://api.telegram.org/bot{봇토큰}/setWebhook?url={앱스크립트URL}
```

예시:
```
https://api.telegram.org/bot7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw/setWebhook?url=https://script.google.com/macros/s/AKfycb.../exec
```

---

## 5. 사용 가능한 명령어

### 기본 명령어

| 명령어 | 설명 |
|--------|------|
| `/도움` 또는 `/help` | 명령어 목록 |
| `/상태` 또는 `/status` | 시스템 상태 |
| `/포지션` 또는 `/position` | 현재 포지션 |
| `/시장` 또는 `/market` | 시장 분석 |
| `/잔고` 또는 `/balance` | 잔고 확인 |
| `/통계` 또는 `/stats` | 승률/통계 |
| `/가격` 또는 `/price` | 실시간 가격 |

---

## 6. 명령어 예시

### /상태 응답 예시
```
🤖 클로드25 트레이딩봇 상태
━━━━━━━━━━━━━━━
💰 현재 잔고: $105.50
📈 총 수익률: +5.50%
📊 열린 포지션: 1개

⚙️ 시스템 상태:
  • 자동매매: ✅ 활성
  • 가격모니터링: ✅ 작동중
  • 트리거: 2개 활성
```

### /포지션 응답 예시
```
📈 현재 포지션
━━━━━━━━━━━━━━━

🎯 BTC-USDT
  방향: 🟢 롱
  레버리지: 100x
  진입가: $97,500.00
  현재가: $97,850.00
  손익: 🟢 +35.90%
  TP1: $97,792.50
  SL: $97,353.75
```

### /시장 응답 예시
```
📊 시장 분석
━━━━━━━━━━━━━━━

💰 BTC 현재가: $97,850.00

📡 최근 신호:
  • 방향: 🟢 롱
  • 점수: 18/28

📈 현재 추세: 🟢 상승 분위기
  (롱 포지션 1개 진행중)
```

### /통계 응답 예시
```
📊 트레이딩 통계
━━━━━━━━━━━━━━━

🏆 승률: 75.0%
📈 총 거래: 12회
✅ 승리: 9회
❌ 패배: 3회

💰 총 수익률: +15.50%
📊 평균 수익: +1.29%
```

### /가격 응답 예시
```
💰 실시간 가격
━━━━━━━━━━━━━━━

₿ BTC: $97,850.00
Ξ ETH: $3,450.00
◎ SOL: $185.50
✕ XRP: $2.35
```

---

## 7. TradingView 알림 종류 (V39)

### 시그널 알림

| 알림 | 설명 | 중요도 |
|------|------|--------|
| 🚀🚀🚀 SUPER LONG | 최고 신뢰도 매수 시그널 | 최고 |
| ⭐⭐ STRONG LONG | 높은 신뢰도 매수 시그널 | 높음 |
| 📗 LONG | 일반 매수 시그널 | 중간 |
| ❌❌ EXIT LONG | 청산 시그널 | 필수 |
| ⚠️ Trail Warning | 주의 (Smart Trail 전환) | 경고 |

### Delta 알림 (신규)

| 알림 | 설명 |
|------|------|
| 📈📈 DELTA 급증 (매수) | 강한 매수세 급증 감지 |
| 📉📉 DELTA 급증 (매도) | 강한 매도세 급증 감지 |
| 🔄 Delta 강세 다이버전스 | 가격↓ + CVD↑ = 반전 신호 |

### 고래 알림

| 알림 | 설명 |
|------|------|
| 🐋WHALE 매수 | 고래 등급 대량 매수 |
| 🦈SHARK 매수 | 상어 등급 매수 |
| 🐬DOLPHIN 매수 | 돌고래 등급 매수 |

### 엘리엇 파동 알림 (신규)

| 알림 | 설명 |
|------|------|
| 🌊 ELLIOTT WAVE 매수 신호 | Wave 2 골든존 (61.8~78.6%) 진입 |
| 🌊 ELLIOTT WAVE 매도 신호 | Wave 2 골든존 숏 진입 (선물) |
| 🔺 TRIANGLE 패턴 감지 | 수렴 삼각형 - 브레이크아웃 대기 |

### 엘리엇 파동 알림 예시

```
🌊 ELLIOTT WAVE 매수 신호! 🌊
BTC/USDT 15 $94500.00
━━━━━━━━━━━━━━
📈 패턴: IMPULSE ↑
🎯 Wave 2 골든존 (61.8~78.6%)
💰 Wave 3 진입 기회!
🛡️ 손절: Wave 1 시작점 ($93200.00)
🎯 목표: 161.8~261.8% 확장
[참고용-투자권유아님]
```

### 엘리엇 파동 패턴 종류

| 패턴 | 구조 | 설명 |
|------|------|------|
| IMPULSE ↑ | 5파동 상승 | Wave 3가 가장 강력 |
| IMPULSE ↓ | 5파동 하락 | 선물 숏 기회 |
| ABC 조정 | 3파동 조정 | 되돌림 후 추세 지속 |
| TRIANGLE | 수렴 삼각형 | 브레이크아웃 대기 |
| FLAT/ZIGZAG | 횡보 조정 | 조정파 진행중 |

### Wave 3 매매법 (피보나치 기반)

```
📈 매수 진입
━━━━━━━━━━━━━━
• Wave 2의 50% 되돌림에서 시작
• 61.8~78.6% (골든존)에서 추가 매수
• 골든존 = 최적 리스크/리워드

🛡️ 손절
━━━━━━━━━━━━━━
• Wave 1 시작점 아래 (78.6% 이상 되돌림 = 파동 무효)

🎯 목표가
━━━━━━━━━━━━━━
• 1차: 100~127.2% 확장
• 2차: 161.8% 확장
• 3차: 261.8% 확장 (Wave 3 최대)
```

### 피보나치 확률 (PDF 기반)

| Wave 2 되돌림 | 확률 |
|--------------|------|
| 38.2% | 12% |
| 50~61.8% | 73% (가장 흔함) |
| 78.6% | 12% |

| Wave 3 확장 | 확률 |
|------------|------|
| 100~161.8% | 15% |
| 161.8~175% | 45% (가장 흔함) |
| 175~261.8% | 30% |

---

## 8. Code.gs 자동 알림 설정

### 신호 발생 시 자동 알림

Code.gs의 `doPost` 함수에서 자동으로 텔레그램 알림 전송:

```javascript
// 신호 수신 시 텔레그램 알림
var telegramMsg = '🔔 <b>새 신호!</b>\n\n';
telegramMsg += (data.signal === 'LONG' ? '🟢' : '🔴') + ' <b>' + data.signal + '</b> ' + data.market + '\n';
telegramMsg += '진입가: $' + data.entry + '\n';
telegramMsg += 'TP1: $' + data.tp1 + '\n';
telegramMsg += 'SL: $' + data.sl + '\n';
telegramMsg += '점수: ' + data.totalScore + '/28';

sendTelegramMessage(TELEGRAM_CONFIG.CHAT_ID, telegramMsg);
```

---

## 9. 테스트

### 9-1. 테스트 메시지 전송

1. 앱스크립트에서 `testTelegramNotification` 함수 실행
2. 텔레그램에서 메시지 확인

### 9-2. 명령어 테스트

1. 봇에게 `/도움` 입력
2. 명령어 목록 응답 확인

---

## 10. 문제 해결

### 봇이 응답하지 않는 경우

1. **토큰 확인**: `TELEGRAM_CONFIG.BOT_TOKEN` 정확한지
2. **웹훅 확인**: `setupTelegramWebhook()` 다시 실행
3. **배포 확인**: 앱스크립트 새 배포 필요할 수 있음
4. **로그 확인**: 앱스크립트 실행 로그에서 오류 확인

### 웹훅 상태 확인

브라우저에서:
```
https://api.telegram.org/bot{봇토큰}/getWebhookInfo
```

정상 응답:
```json
{
  "ok": true,
  "result": {
    "url": "https://script.google.com/macros/s/...",
    "pending_update_count": 0
  }
}
```

### 웹훅 제거 후 재설정

```javascript
// 앱스크립트에서 실행
removeTelegramWebhook();  // 먼저 제거
setupTelegramWebhook();   // 다시 설정
```

---

## 11. 보안 주의사항

- **봇 토큰은 비밀!** 절대 공개하지 마세요
- Chat ID는 본인만 알림 받도록 설정
- 앱스크립트 공유 시 토큰 제거

---

## 요약 체크리스트

- [ ] @BotFather에서 봇 생성
- [ ] 봇 토큰 복사
- [ ] @userinfobot에서 Chat ID 확인
- [ ] Code.gs에 토큰과 Chat ID 입력
- [ ] 앱스크립트 새 배포
- [ ] `setupTelegramWebhook()` 실행
- [ ] `/도움` 명령어로 테스트
