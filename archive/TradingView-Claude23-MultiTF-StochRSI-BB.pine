//@version=5
indicator("í´ë¡œë“œ23 ë©€í‹°TF + StochRSI + BBìŠ¤ìº˜í•‘ (Indicator)", overlay=true, max_labels_count=100)

// ======================== ë²„ì „ ì •ë³´ ========================
// ë²„ì „: v23
// ì—…ë°ì´íŠ¸: 2024-11-21
// ë³€ê²½ì‚¬í•­: Bollinger Bands + RSI ì¡°í•© ì¶”ê°€ (ìŠ¤ìº˜í•‘ ìµœì í™”)
// ì´ì „ ë²„ì „: v22 (StochRSI)
// ========================================================

// ======================== ê°œì„ ëœ ì…ë ¥ ë³€ìˆ˜ ========================
leverageInput = input.int(5, title="ë ˆë²„ë¦¬ì§€", minval=1, maxval=20)
riskPercentInput = input.float(20.0, title="íˆ¬ì… ë¹„ìœ¨ (%)", minval=1.0, maxval=100.0)
tpPct1 = input.float(0.8, title="TP1 ìˆ˜ìµë¥  (%)", minval=0.1, maxval=5.0, step=0.1)
tpPct2 = input.float(1.5, title="TP2 ìˆ˜ìµë¥  (%)", minval=0.1, maxval=5.0, step=0.1)
slPct = input.float(0.3, title="ì†ì ˆ ë¹„ìœ¨ (%)", minval=0.05, maxval=2.0, step=0.05)

// ë©€í‹°íƒ€ì„í”„ë ˆì„ í™œì„±í™” ì˜µì…˜
useMultiTF = input.bool(true, title="ë©€í‹°íƒ€ì„í”„ë ˆì„ í•„í„° ì‚¬ìš©")
strictMode = input.bool(true, title="ì—„ê²© ëª¨ë“œ (ëª¨ë“  ì¡°ê±´ ë§Œì¡±)")

// Stochastic RSI ì„¤ì •
useStochRSI = input.bool(true, title="Stochastic RSI í•„í„° ì‚¬ìš©", group="Stochastic RSI")
stochRSI_length = input.int(14, title="RSI ê¸°ê°„", minval=1, group="Stochastic RSI")
stochRSI_smoothK = input.int(3, title="K í‰í™œí™”", minval=1, group="Stochastic RSI")
stochRSI_smoothD = input.int(3, title="D í‰í™œí™”", minval=1, group="Stochastic RSI")
stochRSI_overbought = input.float(80, title="ê³¼ë§¤ìˆ˜ ë ˆë²¨", minval=50, maxval=100, group="Stochastic RSI")
stochRSI_oversold = input.float(20, title="ê³¼ë§¤ë„ ë ˆë²¨", minval=0, maxval=50, group="Stochastic RSI")

// ğŸ†• v23: Bollinger Bands + RSI ìŠ¤ìº˜í•‘ ì„¤ì •
useBBScalping = input.bool(true, title="ğŸ†• BB ìŠ¤ìº˜í•‘ í•„í„° ì‚¬ìš©", group="Bollinger Bands ìŠ¤ìº˜í•‘")
bb_length = input.int(20, title="BB ê¸°ê°„", minval=1, group="Bollinger Bands ìŠ¤ìº˜í•‘")
bb_mult = input.float(2.0, title="BB í‘œì¤€í¸ì°¨", minval=0.1, maxval=5.0, step=0.1, group="Bollinger Bands ìŠ¤ìº˜í•‘")
bb_rsi_length = input.int(14, title="ìŠ¤ìº˜í•‘ RSI ê¸°ê°„", minval=1, group="Bollinger Bands ìŠ¤ìº˜í•‘")
bb_rsi_overbought = input.float(70, title="ìŠ¤ìº˜í•‘ RSI ê³¼ë§¤ìˆ˜", minval=50, maxval=100, group="Bollinger Bands ìŠ¤ìº˜í•‘")
bb_rsi_oversold = input.float(30, title="ìŠ¤ìº˜í•‘ RSI ê³¼ë§¤ë„", minval=0, maxval=50, group="Bollinger Bands ìŠ¤ìº˜í•‘")
bb_squeeze_threshold = input.float(0.015, title="BB ìŠ¤í€´ì¦ˆ ì„ê³„ê°’ (%)", minval=0.005, maxval=0.05, step=0.001, group="Bollinger Bands ìŠ¤ìº˜í•‘")

// ======================== ğŸ†• v23: Bollinger Bands ê³„ì‚° ========================
// 1ë¶„ë´‰ BB (ì¦‰ê° ë°˜ì‘)
[bb_middle_1m, bb_upper_1m, bb_lower_1m] = ta.bb(close, bb_length, bb_mult)
bb_width_1m = (bb_upper_1m - bb_lower_1m) / bb_middle_1m
bb_squeeze_1m = bb_width_1m < bb_squeeze_threshold  // ë³€ë™ì„± ì¶•ì†Œ êµ¬ê°„

// 3ë¶„ë´‰ BB (ìŠ¤ìº˜í•‘ í™•ì¸)
bb_middle_3m = request.security(syminfo.tickerid, "3", ta.sma(close, bb_length), lookahead=barmerge.lookahead_off)
bb_upper_3m = request.security(syminfo.tickerid, "3", ta.sma(close, bb_length) + bb_mult * ta.stdev(close, bb_length), lookahead=barmerge.lookahead_off)
bb_lower_3m = request.security(syminfo.tickerid, "3", ta.sma(close, bb_length) - bb_mult * ta.stdev(close, bb_length), lookahead=barmerge.lookahead_off)

// ìŠ¤ìº˜í•‘ ì „ìš© RSI (ë¹ ë¥¸ ë°˜ì‘)
rsi_scalping = ta.rsi(close, bb_rsi_length)

// BB ìŠ¤ìº˜í•‘ ì‹ í˜¸
bb_touch_lower = close <= bb_lower_1m * 1.001  // í•˜ë‹¨ ë°´ë“œ ê·¼ì ‘ (0.1% ì—¬ìœ )
bb_touch_upper = close >= bb_upper_1m * 0.999  // ìƒë‹¨ ë°´ë“œ ê·¼ì ‘ (0.1% ì—¬ìœ )
bb_bounce_from_lower = bb_touch_lower[1] and close > bb_lower_1m  // í•˜ë‹¨ ë°˜ë“±
bb_bounce_from_upper = bb_touch_upper[1] and close < bb_upper_1m  // ìƒë‹¨ ë°˜ë“±
bb_breakout_up = close > bb_upper_1m and bb_squeeze_1m[1]  // ìŠ¤í€´ì¦ˆ í›„ ìƒìŠ¹ ëŒíŒŒ
bb_breakout_down = close < bb_lower_1m and bb_squeeze_1m[1]  // ìŠ¤í€´ì¦ˆ í›„ í•˜ë½ ëŒíŒŒ

// BB + RSI ìŠ¤ìº˜í•‘ ì¡°í•©
bb_scalp_long = (bb_touch_lower or bb_bounce_from_lower or bb_breakout_up) and rsi_scalping < bb_rsi_oversold
bb_scalp_short = (bb_touch_upper or bb_bounce_from_upper or bb_breakout_down) and rsi_scalping > bb_rsi_overbought

// BB ì¤‘ê°„ì„  í¬ë¡œìŠ¤ (ì¶”ì„¸ ì „í™˜)
bb_cross_up = ta.crossover(close, bb_middle_1m)
bb_cross_down = ta.crossunder(close, bb_middle_1m)

// ======================== Stochastic RSI ê³„ì‚° ========================
rsi_for_stoch = ta.rsi(close, stochRSI_length)
stoch_k = ta.stoch(rsi_for_stoch, rsi_for_stoch, rsi_for_stoch, stochRSI_length)
stochRSI_k = ta.sma(stoch_k, stochRSI_smoothK)
stochRSI_d = ta.sma(stochRSI_k, stochRSI_smoothD)

// Stochastic RSI ì‹ í˜¸
stochRSI_bullish = stochRSI_k < stochRSI_oversold or (stochRSI_k > stochRSI_k[1] and stochRSI_k < 50)
stochRSI_bearish = stochRSI_k > stochRSI_overbought or (stochRSI_k < stochRSI_k[1] and stochRSI_k > 50)
stochRSI_golden_cross = ta.crossover(stochRSI_k, stochRSI_d)
stochRSI_death_cross = ta.crossunder(stochRSI_k, stochRSI_d)

// ======================== ë©€í‹°íƒ€ì„í”„ë ˆì„ ë°ì´í„° ========================
// 15ë¶„ë´‰ - ì£¼ìš” íŠ¸ë Œë“œ ë°©í–¥
ema20_15m = request.security(syminfo.tickerid, "15", ta.ema(close, 20), lookahead=barmerge.lookahead_off)
ema50_15m = request.security(syminfo.tickerid, "15", ta.ema(close, 50), lookahead=barmerge.lookahead_off)
rsi_15m = request.security(syminfo.tickerid, "15", ta.rsi(close, 14), lookahead=barmerge.lookahead_off)

// 5ë¶„ë´‰ - ì¤‘ê°„ íŠ¸ë Œë“œ í™•ì¸
ema20_5m = request.security(syminfo.tickerid, "5", ta.ema(close, 20), lookahead=barmerge.lookahead_off)
ema50_5m = request.security(syminfo.tickerid, "5", ta.ema(close, 50), lookahead=barmerge.lookahead_off)
[macdLine_5m, signalLine_5m, histogram_5m] = request.security(syminfo.tickerid, "5", ta.macd(close, 12, 26, 9), lookahead=barmerge.lookahead_off)
rsi_5m = request.security(syminfo.tickerid, "5", ta.rsi(close, 14), lookahead=barmerge.lookahead_off)

// 3ë¶„ë´‰ - ì •í™•í•œ ì§„ì…ì 
ema20_3m = request.security(syminfo.tickerid, "3", ta.ema(close, 20), lookahead=barmerge.lookahead_off)
ema50_3m = request.security(syminfo.tickerid, "3", ta.ema(close, 50), lookahead=barmerge.lookahead_off)
[macdLine_3m, signalLine_3m, histogram_3m] = request.security(syminfo.tickerid, "3", ta.macd(close, 12, 26, 9), lookahead=barmerge.lookahead_off)

// í˜„ì¬ ì°¨íŠ¸ (1ë¶„ë´‰) ë³´ì¡° ì§€í‘œ
rsi_1m = ta.rsi(close, 14)
vwma_1m = ta.vwma(close, 20)

// ======================== íŠ¸ë Œë“œ ë°©í–¥ ë¶„ì„ ========================
// 15ë¶„ë´‰ ì£¼ìš” íŠ¸ë Œë“œ
trend_15m_bullish = ema20_15m > ema50_15m and rsi_15m > 45 and rsi_15m < 70
trend_15m_bearish = ema20_15m < ema50_15m and rsi_15m > 30 and rsi_15m < 55

// 5ë¶„ë´‰ ì¤‘ê°„ íŠ¸ë Œë“œ
trend_5m_bullish = ema20_5m > ema50_5m and macdLine_5m > macdLine_5m[1] and rsi_5m > 40
trend_5m_bearish = ema20_5m < ema50_5m and macdLine_5m < macdLine_5m[1] and rsi_5m < 60

// 3ë¶„ë´‰ ì§„ì… ì‹ í˜¸
signal_3m_long = ta.crossover(ema20_3m, ema50_3m) and macdLine_3m > signalLine_3m
signal_3m_short = ta.crossunder(ema20_3m, ema50_3m) and macdLine_3m < signalLine_3m

// ======================== ğŸ†• v23: í†µí•© ìŠ¤ìº˜í•‘ ì‹ í˜¸ ========================
// LONG ì‹ í˜¸: ê¸°ë³¸ + StochRSI + BB ìŠ¤ìº˜í•‘
longSignal_basic = signal_3m_long and rsi_1m > 35 and rsi_1m < 65 and close > vwma_1m

// StochRSI ì¡°ê±´
longSignal_stochRSI = if useStochRSI
    (stochRSI_k < stochRSI_oversold or stochRSI_golden_cross or (stochRSI_k > stochRSI_k[1] and stochRSI_k < 50)) and
    not (stochRSI_k > stochRSI_overbought)
else
    true

// ğŸ†• BB ìŠ¤ìº˜í•‘ ì¡°ê±´
longSignal_BB = if useBBScalping
    // ìŠ¤ìº˜í•‘ ì§„ì…: í•˜ë‹¨ ë°´ë“œ í„°ì¹˜ + RSI ê³¼ë§¤ë„ OR ìŠ¤í€´ì¦ˆ í›„ ëŒíŒŒ
    (bb_scalp_long or (bb_cross_up and rsi_scalping < 50)) and
    close > bb_lower_3m  // 3ë¶„ë´‰ì—ì„œë„ í•˜ë‹¨ ë°´ë“œ ì´ìƒ
else
    true

// í†µí•© LONG ì‹ í˜¸
longSignal_filtered = if useMultiTF
    if strictMode
        // ì—„ê²© ëª¨ë“œ: ëª¨ë“  ì¡°ê±´ ë§Œì¡±
        longSignal_basic and trend_15m_bullish and trend_5m_bullish and longSignal_stochRSI and longSignal_BB
    else
        // ì™„í™” ëª¨ë“œ: 15ë¶„ ë˜ëŠ” 5ë¶„ ì¤‘ í•˜ë‚˜ + BB ìŠ¤ìº˜í•‘
        longSignal_basic and (trend_15m_bullish or trend_5m_bullish) and longSignal_stochRSI and longSignal_BB
else
    longSignal_basic and longSignal_stochRSI and longSignal_BB

// SHORT ì‹ í˜¸: ê¸°ë³¸ + StochRSI + BB ìŠ¤ìº˜í•‘
shortSignal_basic = signal_3m_short and rsi_1m > 35 and rsi_1m < 65 and close < vwma_1m

// StochRSI ì¡°ê±´
shortSignal_stochRSI = if useStochRSI
    (stochRSI_k > stochRSI_overbought or stochRSI_death_cross or (stochRSI_k < stochRSI_k[1] and stochRSI_k > 50)) and
    not (stochRSI_k < stochRSI_oversold)
else
    true

// ğŸ†• BB ìŠ¤ìº˜í•‘ ì¡°ê±´
shortSignal_BB = if useBBScalping
    // ìŠ¤ìº˜í•‘ ì§„ì…: ìƒë‹¨ ë°´ë“œ í„°ì¹˜ + RSI ê³¼ë§¤ìˆ˜ OR ìŠ¤í€´ì¦ˆ í›„ ëŒíŒŒ
    (bb_scalp_short or (bb_cross_down and rsi_scalping > 50)) and
    close < bb_upper_3m  // 3ë¶„ë´‰ì—ì„œë„ ìƒë‹¨ ë°´ë“œ ì´í•˜
else
    true

// í†µí•© SHORT ì‹ í˜¸
shortSignal_filtered = if useMultiTF
    if strictMode
        // ì—„ê²© ëª¨ë“œ: ëª¨ë“  ì¡°ê±´ ë§Œì¡±
        shortSignal_basic and trend_15m_bearish and trend_5m_bearish and shortSignal_stochRSI and shortSignal_BB
    else
        // ì™„í™” ëª¨ë“œ: 15ë¶„ ë˜ëŠ” 5ë¶„ ì¤‘ í•˜ë‚˜ + BB ìŠ¤ìº˜í•‘
        shortSignal_basic and (trend_15m_bearish or trend_5m_bearish) and shortSignal_stochRSI and shortSignal_BB
else
    shortSignal_basic and shortSignal_stochRSI and shortSignal_BB

// ======================== ì°¨íŠ¸ í‘œì‹œ ========================
// BB ë¼ì¸ í‘œì‹œ
plot(bb_upper_1m, color=color.new(color.blue, 50), linewidth=1, title="BB Upper")
plot(bb_middle_1m, color=color.new(color.gray, 50), linewidth=1, title="BB Middle")
plot(bb_lower_1m, color=color.new(color.blue, 50), linewidth=1, title="BB Lower")

// BB ìŠ¤í€´ì¦ˆ êµ¬ê°„ ë°°ê²½ìƒ‰
bgcolor(bb_squeeze_1m ? color.new(color.yellow, 90) : na, title="BB Squeeze")

// ì‹ í˜¸ í‘œì‹œ
plotshape(longSignal_filtered, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.normal, title="ğŸ†• v23 LONG")
plotshape(shortSignal_filtered, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.normal, title="ğŸ†• v23 SHORT")

// í•„í„°ë§ëœ ì‹ í˜¸ (íšŒìƒ‰ ì )
plotshape(longSignal_basic and not longSignal_filtered, style=shape.circle, location=location.belowbar, color=color.gray, size=size.tiny, title="í•„í„°ë§ëœ LONG")
plotshape(shortSignal_basic and not shortSignal_filtered, style=shape.circle, location=location.abovebar, color=color.gray, size=size.tiny, title="í•„í„°ë§ëœ SHORT")

// EMA ë¼ì¸ í‘œì‹œ
plot(ema20_15m, color=color.blue, linewidth=1, title="EMA20 (15m)")
plot(ema50_15m, color=color.red, linewidth=1, title="EMA50 (15m)")

// ======================== ì‹ í˜¸ ë°œìƒ ì‹œ TP/SL ê³„ì‚° ë° í‘œì‹œ ========================
var label timeLabel = na
var line tp1Line = na
var line tp2Line = na
var line slLine = na

if longSignal_filtered
    if not na(timeLabel)
        label.delete(timeLabel)
    if not na(tp1Line)
        line.delete(tp1Line)
    if not na(tp2Line)
        line.delete(tp2Line)
    if not na(slLine)
        line.delete(slLine)

    float labelTp1 = close * (1 + tpPct1/100)
    float labelTp2 = close * (1 + tpPct2/100)
    float labelSl = close * (1 - slPct/100)

    // BB íƒ€ì… íŒë³„
    string bbType = bb_scalp_long ? "ğŸ¯BBë°˜ì „" : bb_breakout_up ? "ğŸ’¥BBëŒíŒŒ" : "ğŸ“ŠBBì¤‘ë¦½"

    timeLabel := label.new(bar_index, low - (high - low) * 0.2,
                          text="ğŸ“… " + str.format_time(time, "MM-dd HH:mm", "Asia/Seoul") +
                               "\nğŸ”¥ v23 ìŠ¤ìº˜í•‘ LONG / $" + str.tostring(close, "#.##") +
                               "\nTP1: $" + str.tostring(labelTp1, "#.##") + " / TP2: $" + str.tostring(labelTp2, "#.##") +
                               "\nSL: $" + str.tostring(labelSl, "#.##") +
                               "\n15m:" + (trend_15m_bullish ? "âœ…" : "âŒ") + " 5m:" + (trend_5m_bullish ? "âœ…" : "âŒ") +
                               "\nStochK:" + str.tostring(stochRSI_k, "#.#") + " " + (stochRSI_golden_cross ? "ğŸŸ¢GC" : "") +
                               "\n" + bbType + " RSI:" + str.tostring(rsi_scalping, "#") + " BBí­:" + str.tostring(bb_width_1m*100, "#.##") + "%",
                          style=label.style_label_up,
                          color=color.new(color.green, 40),
                          textcolor=color.white, size=size.normal)

    tp1Line := line.new(bar_index, labelTp1, bar_index + 10, labelTp1, color=color.green, width=2, style=line.style_dashed)
    tp2Line := line.new(bar_index, labelTp2, bar_index + 10, labelTp2, color=color.green, width=2, style=line.style_solid)
    slLine := line.new(bar_index, labelSl, bar_index + 10, labelSl, color=color.red, width=2, style=line.style_solid)

if shortSignal_filtered
    if not na(timeLabel)
        label.delete(timeLabel)
    if not na(tp1Line)
        line.delete(tp1Line)
    if not na(tp2Line)
        line.delete(tp2Line)
    if not na(slLine)
        line.delete(slLine)

    float labelTp1 = close * (1 - tpPct1/100)
    float labelTp2 = close * (1 - tpPct2/100)
    float labelSl = close * (1 + slPct/100)

    // BB íƒ€ì… íŒë³„
    string bbType = bb_scalp_short ? "ğŸ¯BBë°˜ì „" : bb_breakout_down ? "ğŸ’¥BBëŒíŒŒ" : "ğŸ“ŠBBì¤‘ë¦½"

    timeLabel := label.new(bar_index, high + (high - low) * 0.2,
                          text="ğŸ“… " + str.format_time(time, "MM-dd HH:mm", "Asia/Seoul") +
                               "\nğŸ”¥ v23 ìŠ¤ìº˜í•‘ SHORT / $" + str.tostring(close, "#.##") +
                               "\nTP1: $" + str.tostring(labelTp1, "#.##") + " / TP2: $" + str.tostring(labelTp2, "#.##") +
                               "\nSL: $" + str.tostring(labelSl, "#.##") +
                               "\n15m:" + (trend_15m_bearish ? "âœ…" : "âŒ") + " 5m:" + (trend_5m_bearish ? "âœ…" : "âŒ") +
                               "\nStochK:" + str.tostring(stochRSI_k, "#.#") + " " + (stochRSI_death_cross ? "ğŸ”´DC" : "") +
                               "\n" + bbType + " RSI:" + str.tostring(rsi_scalping, "#") + " BBí­:" + str.tostring(bb_width_1m*100, "#.##") + "%",
                          style=label.style_label_down,
                          color=color.new(color.red, 40),
                          textcolor=color.white, size=size.normal)

    tp1Line := line.new(bar_index, labelTp1, bar_index + 10, labelTp1, color=color.green, width=2, style=line.style_dashed)
    tp2Line := line.new(bar_index, labelTp2, bar_index + 10, labelTp2, color=color.green, width=2, style=line.style_solid)
    slLine := line.new(bar_index, labelSl, bar_index + 10, labelSl, color=color.red, width=2, style=line.style_solid)

// ======================== ê°œì„ ëœ ì •ë³´ í…Œì´ë¸” ========================
var table infoTable = table.new(position.top_right, 2, 12, bgcolor=color.white, border_width=1)

if barstate.islast
    table.clear(infoTable, 0, 0, 1, 11)

    // í—¤ë”
    table.cell(infoTable, 0, 0, "ğŸ†• v23 ìŠ¤ìº˜í•‘", text_color=color.white, text_size=size.normal, bgcolor=color.new(color.orange, 20))
    table.cell(infoTable, 1, 0, "BB + RSI ì¶”ê°€", text_color=color.white, text_size=size.normal, bgcolor=color.new(color.blue, 20))

    table.cell(infoTable, 0, 1, "Current Price", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 1, "$" + str.tostring(close, "#.#"), text_color=color.black, text_size=size.small)

    // ğŸ†• BB ì •ë³´
    table.cell(infoTable, 0, 2, "ğŸ†• BB Width", text_color=color.black, text_size=size.small, bgcolor=color.new(color.yellow, 80))
    string bbStatus = str.tostring(bb_width_1m*100, "#.##") + "% " + (bb_squeeze_1m ? "ğŸŸ¡ìŠ¤í€´ì¦ˆ" : "")
    table.cell(infoTable, 1, 2, bbStatus, text_color=bb_squeeze_1m ? color.orange : color.blue, text_size=size.small)

    table.cell(infoTable, 0, 3, "ğŸ†• ìŠ¤ìº˜í•‘ RSI", text_color=color.black, text_size=size.small, bgcolor=color.new(color.yellow, 80))
    color rsiColor = rsi_scalping < bb_rsi_oversold ? color.green : rsi_scalping > bb_rsi_overbought ? color.red : color.gray
    table.cell(infoTable, 1, 3, str.tostring(rsi_scalping, "#.#"), text_color=rsiColor, text_size=size.small)

    table.cell(infoTable, 0, 4, "BB Position", text_color=color.black, text_size=size.small)
    string bbPos = close > bb_upper_1m ? "ìƒë‹¨ ì´íƒˆ" : close < bb_lower_1m ? "í•˜ë‹¨ ì´íƒˆ" : "ë°´ë“œ ë‚´"
    color bbPosColor = close > bb_upper_1m ? color.red : close < bb_lower_1m ? color.green : color.gray
    table.cell(infoTable, 1, 4, bbPos, text_color=bbPosColor, text_size=size.small)

    table.cell(infoTable, 0, 5, "15m Trend", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 5, trend_15m_bullish ? "ğŸŸ¢ BULL" : trend_15m_bearish ? "ğŸ”´ BEAR" : "âšª FLAT", text_color=trend_15m_bullish ? color.green : trend_15m_bearish ? color.red : color.gray, text_size=size.small)

    table.cell(infoTable, 0, 6, "5m Trend", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 6, trend_5m_bullish ? "ğŸŸ¢ BULL" : trend_5m_bearish ? "ğŸ”´ BEAR" : "âšª FLAT", text_color=trend_5m_bullish ? color.green : trend_5m_bearish ? color.red : color.gray, text_size=size.small)

    table.cell(infoTable, 0, 7, "StochRSI K", text_color=color.black, text_size=size.small)
    string stochStatus = str.tostring(stochRSI_k, "#.#")
    color stochColor = stochRSI_k < stochRSI_oversold ? color.green : stochRSI_k > stochRSI_overbought ? color.red : color.gray
    if stochRSI_golden_cross
        stochStatus := stochStatus + " ğŸŸ¢GC"
    if stochRSI_death_cross
        stochStatus := stochStatus + " ğŸ”´DC"
    table.cell(infoTable, 1, 7, stochStatus, text_color=stochColor, text_size=size.small)

    table.cell(infoTable, 0, 8, "Next Signal", text_color=color.black, text_size=size.small)
    string nextSignal = "ëŒ€ê¸°ì¤‘"
    if trend_15m_bullish and trend_5m_bullish and stochRSI_bullish and (bb_touch_lower or bb_squeeze_1m)
        nextSignal := "ğŸŸ¢ LONG ì¤€ë¹„"
    else if trend_15m_bearish and trend_5m_bearish and stochRSI_bearish and (bb_touch_upper or bb_squeeze_1m)
        nextSignal := "ğŸ”´ SHORT ì¤€ë¹„"
    table.cell(infoTable, 1, 8, nextSignal, text_color=str.contains(nextSignal, "LONG") ? color.green : str.contains(nextSignal, "SHORT") ? color.red : color.gray, text_size=size.small)

    table.cell(infoTable, 0, 9, "TP1/TP2/SL", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 9, str.tostring(tpPct1, "#.#") + "%/" + str.tostring(tpPct2, "#.#") + "%/" + str.tostring(slPct, "#.#") + "%", text_color=color.blue, text_size=size.small)

    table.cell(infoTable, 0, 10, "Leverage", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 10, str.tostring(leverageInput) + "ë°° Ã— " + str.tostring(riskPercentInput) + "%", text_color=color.orange, text_size=size.small)

    table.cell(infoTable, 0, 11, "Mode", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 11, strictMode ? "ì—„ê²©ëª¨ë“œ" : "ì™„í™”ëª¨ë“œ", text_color=strictMode ? color.red : color.green, text_size=size.small)

// ======================== ì•ŒëŒ ì„¤ì • (Google Sheets ì—°ë™) ========================
if longSignal_filtered
    // ğŸ†• v23: BB + RSI ë°ì´í„° ì¶”ê°€
    string jsonData = '{"version":"23",' +
          '"date":"' + str.format_time(time, "yyyy-MM-dd", "Asia/Seoul") + '",' +
          '"time":"' + str.format_time(time, "HH:mm", "Asia/Seoul") + '",' +
          '"signal":"LONG",' +
          '"entry":"' + str.tostring(close, "#.##") + '",' +
          '"tp1":"' + str.tostring(close * (1 + tpPct1/100), "#.##") + '",' +
          '"tp2":"' + str.tostring(close * (1 + tpPct2/100), "#.##") + '",' +
          '"sl":"' + str.tostring(close * (1 - slPct/100), "#.##") + '",' +
          '"trend15m":"' + (trend_15m_bullish ? "BULL" : "BEAR") + '",' +
          '"trend5m":"' + (trend_5m_bullish ? "BULL" : trend_5m_bearish ? "BEAR" : "FLAT") + '",' +
          '"stochRSI_k":"' + str.tostring(stochRSI_k, "#.##") + '",' +
          '"stochRSI_signal":"' + (stochRSI_golden_cross ? "GOLDEN_CROSS" : stochRSI_k < stochRSI_oversold ? "OVERSOLD" : "BULLISH") + '",' +
          '"bb_width":"' + str.tostring(bb_width_1m*100, "#.##") + '",' +
          '"bb_squeeze":"' + (bb_squeeze_1m ? "true" : "false") + '",' +
          '"scalping_rsi":"' + str.tostring(rsi_scalping, "#.##") + '",' +
          '"bb_signal":"' + (bb_scalp_long ? "BB_REVERSAL" : bb_breakout_up ? "BB_BREAKOUT" : "BB_NEUTRAL") + '"}'

    alert(jsonData, freq=alert.freq_once_per_bar)

if shortSignal_filtered
    // ğŸ†• v23: BB + RSI ë°ì´í„° ì¶”ê°€
    string jsonData = '{"version":"23",' +
          '"date":"' + str.format_time(time, "yyyy-MM-dd", "Asia/Seoul") + '",' +
          '"time":"' + str.format_time(time, "HH:mm", "Asia/Seoul") + '",' +
          '"signal":"SHORT",' +
          '"entry":"' + str.tostring(close, "#.##") + '",' +
          '"tp1":"' + str.tostring(close * (1 - tpPct1/100), "#.##") + '",' +
          '"tp2":"' + str.tostring(close * (1 - tpPct2/100), "#.##") + '",' +
          '"sl":"' + str.tostring(close * (1 + slPct/100), "#.##") + '",' +
          '"trend15m":"' + (trend_15m_bearish ? "BEAR" : "BULL") + '",' +
          '"trend5m":"' + (trend_5m_bullish ? "BULL" : trend_5m_bearish ? "BEAR" : "FLAT") + '",' +
          '"stochRSI_k":"' + str.tostring(stochRSI_k, "#.##") + '",' +
          '"stochRSI_signal":"' + (stochRSI_death_cross ? "DEATH_CROSS" : stochRSI_k > stochRSI_overbought ? "OVERBOUGHT" : "BEARISH") + '",' +
          '"bb_width":"' + str.tostring(bb_width_1m*100, "#.##") + '",' +
          '"bb_squeeze":"' + (bb_squeeze_1m ? "true" : "false") + '",' +
          '"scalping_rsi":"' + str.tostring(rsi_scalping, "#.##") + '",' +
          '"bb_signal":"' + (bb_scalp_short ? "BB_REVERSAL" : bb_breakout_down ? "BB_BREAKOUT" : "BB_NEUTRAL") + '"}'

    alert(jsonData, freq=alert.freq_once_per_bar)
