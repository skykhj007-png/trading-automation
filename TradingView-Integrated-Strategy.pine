//@version=5
indicator("ÌÜµÌï© Ï†ÑÎûµ (Î∂àÏû•Îã®ÌÉÄÏôï + ÌÅ¥Î°úÎìú21)", overlay=true, max_labels_count=100)

// ============================================
// ÏÑ§Ï†ï
// ============================================

// Î†àÎ≤ÑÎ¶¨ÏßÄ Î∞è Ìè¨ÏßÄÏÖò Í¥ÄÎ¶¨
leverageInput = input.int(5, title="Î†àÎ≤ÑÎ¶¨ÏßÄ", minval=1, maxval=20)
riskPercentInput = input.float(20.0, title="Ìà¨ÏûÖ ÎπÑÏú® (%)", minval=1.0, maxval=100.0)

// ÏÜêÏùµ ÏÑ§Ï†ï (ÌÅ¥Î°úÎìú21 Í∏∞Ï§Ä - Îã®ÌÉÄ)
tpPct1 = input.float(0.8, title="TP1 ÏàòÏùµÎ•† (%)", minval=0.1, maxval=5.0, step=0.1)
tpPct2 = input.float(1.5, title="TP2 ÏàòÏùµÎ•† (%)", minval=0.1, maxval=5.0, step=0.1)
slPct = input.float(0.3, title="ÏÜêÏ†à ÎπÑÏú® (%)", minval=0.05, maxval=2.0, step=0.05)

// Ïã†Ìò∏ Í∞ïÎèÑ ÏÑ§Ï†ï
minSignalStrength = input.int(12, title="ÏµúÏÜå Ïã†Ìò∏ Í∞ïÎèÑ", minval=8, maxval=20, tooltip="ÎÜíÏùÑÏàòÎ°ù Î≥¥ÏàòÏ†Å, ÎÇÆÏùÑÏàòÎ°ù Í≥µÍ≤©Ï†Å")
strictMode = input.bool(true, title="ÏóÑÍ≤© Î™®Îìú", tooltip="Î™®Îì† Ï°∞Í±¥ ÎßåÏ°± ÌïÑÏöî")

// Î©ÄÌã∞ÌÉÄÏûÑÌîÑÎ†àÏûÑ ÌôúÏÑ±Ìôî
useMultiTF = input.bool(true, title="Î©ÄÌã∞ÌÉÄÏûÑÌîÑÎ†àÏûÑ ÌïÑÌÑ∞ ÏÇ¨Ïö©")

// ============================================
// Î∂àÏû•Îã®ÌÉÄÏôï Ï†ÑÎûµ - VWAP Î∞è Ïù¥ÎèôÌèâÍ∑†
// ============================================

// VWAP 100 Í≥ÑÏÇ∞ (Í±∞ÎûòÎüâ Í∞ÄÏ§ë Ïù¥ÎèôÌèâÍ∑†)
vwap100 = ta.vwma(close, 100)

// Îã§Ï§ë Ïù¥ÎèôÌèâÍ∑†ÏÑ†
ma7 = ta.sma(close, 7)
ma15 = ta.sma(close, 15)
ma50 = ta.sma(close, 50)
ma100 = ta.sma(close, 100)
ma200 = ta.sma(close, 200)
ma400 = ta.sma(close, 400)

// Î≥ºÎ•® ÌîÑÎ°úÌååÏùº POCÎäî Pine ScriptÏóêÏÑú ÏßÅÏ†ë Í≥ÑÏÇ∞ Ïñ¥Î†§ÏõÄ - Í∑ºÏÇ¨Í∞í ÏÇ¨Ïö©
// ÏµúÍ∑º 100Í∞ú Î¥âÏùò ÏµúÎåÄ Í±∞ÎûòÎüâ Î∞úÏÉù Í∞ÄÍ≤©
var float pocPrice = close
var float maxVolume = 0
for i = 0 to 99
    if volume[i] > maxVolume
        maxVolume := volume[i]
        pocPrice := close[i]

// ============================================
// Î∂àÏû•Îã®ÌÉÄÏôï Ï†êÏàò Í≥ÑÏÇ∞ (ÏµúÎåÄ 10Ï†ê)
// ============================================

var float bulJangScore = 0
bulJangScore := 0

// 1. VWAP 100 ÌÑ∞Ïπò (3Ï†ê)
touchingVWAP = math.abs(close - vwap100) / vwap100 < 0.01  // 1% Ïù¥ÎÇ¥
if touchingVWAP
    bulJangScore += 3

// 2. ÌÑ∞Îãù Ìè¨Ïù∏Ìä∏ Í∞êÏßÄ (5Ï†ê)
// - Ïù¥ÌèâÏÑ† Í∏∞Ïö∏Í∏∞ ÏôÑÎßå
ma50_slope = ma50 - ma50[5]
ma100_slope = vwap100 - vwap100[5]
ma50_gentle = math.abs(ma50_slope) < close * 0.01
vwap_gentle = math.abs(ma100_slope) < close * 0.01

// - ÏµúÍ∑º ÏÉÅÏäπ Ï∂îÏÑ∏
upCount = 0
for i = 0 to 4
    if close[i] > close[i + 1]
        upCount += 1

recentUptrend = upCount >= 3

// - VWAP Í≥®Îì†ÌÅ¨Î°úÏä§
vwapGoldenCross = ta.crossover(close, vwap100)

turningPoint = (ma50_gentle or vwap_gentle) and recentUptrend
if turningPoint
    bulJangScore += 5

if vwapGoldenCross
    bulJangScore += 2  // Ï∂îÍ∞Ä Ï†êÏàò

// 3. Ï†ïÎ∞∞Ïó¥ ÌôïÏù∏ (2Ï†ê)
isUptrend = ma7 > ma15 and ma15 > ma50
if isUptrend
    bulJangScore += 2

// ============================================
// ÌÅ¥Î°úÎìú21 Î©ÄÌã∞ÌÉÄÏûÑÌîÑÎ†àÏûÑ Ï†ÑÎûµ
// ============================================

// 15Î∂ÑÎ¥â - Ï£ºÏöî Ìä∏Î†åÎìú
ema20_15m = request.security(syminfo.tickerid, "15", ta.ema(close, 20), lookahead=barmerge.lookahead_off)
ema50_15m = request.security(syminfo.tickerid, "15", ta.ema(close, 50), lookahead=barmerge.lookahead_off)
rsi_15m = request.security(syminfo.tickerid, "15", ta.rsi(close, 14), lookahead=barmerge.lookahead_off)

trend_15m_bullish = ema20_15m > ema50_15m and rsi_15m > 45 and rsi_15m < 70
trend_15m_bearish = ema20_15m < ema50_15m and rsi_15m > 30 and rsi_15m < 55

// 5Î∂ÑÎ¥â - Ï§ëÍ∞Ñ Ìä∏Î†åÎìú
ema20_5m = request.security(syminfo.tickerid, "5", ta.ema(close, 20), lookahead=barmerge.lookahead_off)
ema50_5m = request.security(syminfo.tickerid, "5", ta.ema(close, 50), lookahead=barmerge.lookahead_off)
[macdLine_5m, signalLine_5m, histogram_5m] = request.security(syminfo.tickerid, "5", ta.macd(close, 12, 26, 9), lookahead=barmerge.lookahead_off)
rsi_5m = request.security(syminfo.tickerid, "5", ta.rsi(close, 14), lookahead=barmerge.lookahead_off)

macd_rising_5m = macdLine_5m > macdLine_5m[1]
trend_5m_bullish = ema20_5m > ema50_5m and macd_rising_5m and rsi_5m > 40
trend_5m_bearish = ema20_5m < ema50_5m and not macd_rising_5m and rsi_5m < 60

// 3Î∂ÑÎ¥â - ÏßÑÏûÖ Ïã†Ìò∏
ema20_3m = request.security(syminfo.tickerid, "3", ta.ema(close, 20), lookahead=barmerge.lookahead_off)
ema50_3m = request.security(syminfo.tickerid, "3", ta.ema(close, 50), lookahead=barmerge.lookahead_off)
[macdLine_3m, signalLine_3m, histogram_3m] = request.security(syminfo.tickerid, "3", ta.macd(close, 12, 26, 9), lookahead=barmerge.lookahead_off)

signal_3m_long = ta.crossover(ema20_3m, ema50_3m) and macdLine_3m > signalLine_3m
signal_3m_short = ta.crossunder(ema20_3m, ema50_3m) and macdLine_3m < signalLine_3m

// 1Î∂ÑÎ¥â - ÌòÑÏû¨ Ï∞®Ìä∏ Î≥¥Ï°∞
rsi_1m = ta.rsi(close, 14)
vwma_1m = ta.vwma(close, 20)

// ============================================
// ÌÅ¥Î°úÎìú21 Ï†êÏàò Í≥ÑÏÇ∞ (ÏµúÎåÄ 8Ï†ê)
// ============================================

var float claude21Score = 0
claude21Score := 0

// Í∏∞Î≥∏ Ïã†Ìò∏ (3Ï†ê)
longSignal_basic = signal_3m_long and rsi_1m > 35 and rsi_1m < 65 and close > vwma_1m
shortSignal_basic = signal_3m_short and rsi_1m > 35 and rsi_1m < 65 and close < vwma_1m

if longSignal_basic
    claude21Score += 3
if shortSignal_basic
    claude21Score += 3

// 15Î∂ÑÎ¥â Ìä∏Î†åÎìú (3Ï†ê)
if trend_15m_bullish and longSignal_basic
    claude21Score += 3
if trend_15m_bearish and shortSignal_basic
    claude21Score += 3

// 5Î∂ÑÎ¥â Ìä∏Î†åÎìú (2Ï†ê)
if trend_5m_bullish and longSignal_basic
    claude21Score += 2
if trend_5m_bearish and shortSignal_basic
    claude21Score += 2

// ============================================
// Ï∂îÍ∞Ä ÌïÑÌÑ∞ Ï†êÏàò (ÏµúÎåÄ 6Ï†ê)
// ============================================

var float filterScore = 0
filterScore := 0

// 1. ÌèâÍ∑† ÌöåÍ∑Ä Ï≤¥ÌÅ¨ (2Ï†ê)
deviation = (close - vwap100) / vwap100 * 100
meanReversionOK = math.abs(deviation) < 10  // ¬±10% Ïù¥ÎÇ¥
if meanReversionOK
    filterScore += 2

// 2. POC Í∑ºÏ≤ò (2Ï†ê)
nearPOC = math.abs(close - pocPrice) / pocPrice < 0.02  // ¬±2% Ïù¥ÎÇ¥
if nearPOC
    filterScore += 2

// 3. 200ÏÑ† ÏúÑ (2Ï†ê)
above200MA = close > ma200
if above200MA
    filterScore += 2

// ============================================
// ÏµúÏ¢Ö Ïã†Ìò∏ Í≤∞Ï†ï
// ============================================

var float totalScore = 0
totalScore := bulJangScore + claude21Score + filterScore

// LONG Ïã†Ìò∏: Î∂àÏû•Îã®ÌÉÄÏôï + ÌÅ¥Î°úÎìú21 Î™®Îëê ÎèôÏùò
longSignal_final = bulJangScore >= 5 and longSignal_basic and totalScore >= minSignalStrength

// SHORT Ïã†Ìò∏: ÌÅ¥Î°úÎìú21 SHORT + Î∂àÏû•Îã®ÌÉÄÏôï Ïó≠Î∞∞Ïó¥
shortSignal_final = shortSignal_basic and not isUptrend and close < ma200 and totalScore >= minSignalStrength

// ÏóÑÍ≤© Î™®Îìú Ï∂îÍ∞Ä ÌïÑÌÑ∞ÎßÅ
if strictMode and useMultiTF
    longSignal_final := longSignal_final and trend_15m_bullish and trend_5m_bullish
    shortSignal_final := shortSignal_final and trend_15m_bearish and trend_5m_bearish

// ============================================
// Ï∞®Ìä∏ ÌëúÏãú
// ============================================

// VWAP Î∞è Ï£ºÏöî Ïù¥ÎèôÌèâÍ∑†ÏÑ†
plot(vwap100, color=color.new(color.purple, 0), linewidth=3, title="VWAP 100")
plot(ma50, color=color.new(color.orange, 0), linewidth=2, title="MA 50")
plot(ma200, color=color.new(color.blue, 0), linewidth=2, title="MA 200")

// 15Î∂ÑÎ¥â EMA (Ï∞∏Í≥†Ïö©)
plot(ema20_15m, color=color.new(color.green, 50), linewidth=1, title="EMA20 (15m)")
plot(ema50_15m, color=color.new(color.red, 50), linewidth=1, title="EMA50 (15m)")

// Ïã†Ìò∏ ÌëúÏãú
plotshape(longSignal_final, style=shape.triangleup, location=location.belowbar,
         color=color.new(color.green, 0), size=size.normal, title="ÌÜµÌï© LONG")
plotshape(shortSignal_final, style=shape.triangledown, location=location.abovebar,
         color=color.new(color.red, 0), size=size.normal, title="ÌÜµÌï© SHORT")

// ÏïΩÌïú Ïã†Ìò∏ (ÌïÑÌÑ∞ÎßÅÎê®)
plotshape(longSignal_basic and not longSignal_final, style=shape.circle, location=location.belowbar,
         color=color.new(color.gray, 50), size=size.tiny, title="ÏïΩÌïú LONG")
plotshape(shortSignal_basic and not shortSignal_final, style=shape.circle, location=location.abovebar,
         color=color.new(color.gray, 50), size=size.tiny, title="ÏïΩÌïú SHORT")

// ============================================
// Ïã†Ìò∏ Î∞úÏÉù Ïãú TP/SL ÌëúÏãú
// ============================================

var label signalLabel = na
var line tp1Line = na
var line tp2Line = na
var line slLine = na

if longSignal_final
    if not na(signalLabel)
        label.delete(signalLabel)
    if not na(tp1Line)
        line.delete(tp1Line)
    if not na(tp2Line)
        line.delete(tp2Line)
    if not na(slLine)
        line.delete(slLine)

    float labelTp1 = close * (1 + tpPct1/100)
    float labelTp2 = close * (1 + tpPct2/100)
    float labelSl = close * (1 - slPct/100)

    signalLabel := label.new(bar_index, low - (high - low) * 0.3,
                          text="üî• ÌÜµÌï© LONG\n" +
                               "ÏßÑÏûÖ: $" + str.tostring(close, "#.##") + "\n" +
                               "Ï†êÏàò: " + str.tostring(totalScore, "#.#") + "/" + str.tostring(minSignalStrength) + "\n" +
                               "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n" +
                               "Î∂àÏû•: " + str.tostring(bulJangScore, "#") + "/10 " +
                               (touchingVWAP ? "‚úÖV " : "") +
                               (turningPoint ? "‚úÖT " : "") +
                               (isUptrend ? "‚úÖÏ†ï " : "") + "\n" +
                               "ÌÅ¥Î°úÎìú: " + str.tostring(claude21Score, "#") + "/8 " +
                               (trend_15m_bullish ? "‚úÖ15 " : "") +
                               (trend_5m_bullish ? "‚úÖ5 " : "") + "\n" +
                               "ÌïÑÌÑ∞: " + str.tostring(filterScore, "#") + "/6 " +
                               (meanReversionOK ? "‚úÖÌöåÍ∑Ä " : "") +
                               (above200MA ? "‚úÖ200 " : "") + "\n" +
                               "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n" +
                               "TP1: $" + str.tostring(labelTp1, "#.##") + " (50%)\n" +
                               "TP2: $" + str.tostring(labelTp2, "#.##") + " (50%)\n" +
                               "SL: $" + str.tostring(labelSl, "#.##"),
                          style=label.style_label_up,
                          color=color.new(color.green, 20),
                          textcolor=color.white, size=size.normal)

    tp1Line := line.new(bar_index, labelTp1, bar_index + 20, labelTp1,
                       color=color.new(color.green, 0), width=2, style=line.style_dashed)
    tp2Line := line.new(bar_index, labelTp2, bar_index + 20, labelTp2,
                       color=color.new(color.green, 0), width=3, style=line.style_solid)
    slLine := line.new(bar_index, labelSl, bar_index + 20, labelSl,
                      color=color.new(color.red, 0), width=2, style=line.style_solid)

if shortSignal_final
    if not na(signalLabel)
        label.delete(signalLabel)
    if not na(tp1Line)
        line.delete(tp1Line)
    if not na(tp2Line)
        line.delete(tp2Line)
    if not na(slLine)
        line.delete(slLine)

    float labelTp1 = close * (1 - tpPct1/100)
    float labelTp2 = close * (1 - tpPct2/100)
    float labelSl = close * (1 + slPct/100)

    signalLabel := label.new(bar_index, high + (high - low) * 0.3,
                          text="üî• ÌÜµÌï© SHORT\n" +
                               "ÏßÑÏûÖ: $" + str.tostring(close, "#.##") + "\n" +
                               "Ï†êÏàò: " + str.tostring(totalScore, "#.#") + "/" + str.tostring(minSignalStrength) + "\n" +
                               "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n" +
                               "Î∂àÏû•: " + str.tostring(bulJangScore, "#") + "/10\n" +
                               "ÌÅ¥Î°úÎìú: " + str.tostring(claude21Score, "#") + "/8\n" +
                               "ÌïÑÌÑ∞: " + str.tostring(filterScore, "#") + "/6\n" +
                               "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n" +
                               "TP1: $" + str.tostring(labelTp1, "#.##") + " (50%)\n" +
                               "TP2: $" + str.tostring(labelTp2, "#.##") + " (50%)\n" +
                               "SL: $" + str.tostring(labelSl, "#.##"),
                          style=label.style_label_down,
                          color=color.new(color.red, 20),
                          textcolor=color.white, size=size.normal)

    tp1Line := line.new(bar_index, labelTp1, bar_index + 20, labelTp1,
                       color=color.new(color.green, 0), width=2, style=line.style_dashed)
    tp2Line := line.new(bar_index, labelTp2, bar_index + 20, labelTp2,
                       color=color.new(color.green, 0), width=3, style=line.style_solid)
    slLine := line.new(bar_index, labelSl, bar_index + 20, labelSl,
                      color=color.new(color.red, 0), width=2, style=line.style_solid)

// ============================================
// Ï†ïÎ≥¥ ÌÖåÏù¥Î∏î
// ============================================

var table infoTable = table.new(position.top_right, 2, 12, bgcolor=color.new(color.white, 10), border_width=1)

if barstate.islast
    table.clear(infoTable, 0, 0, 1, 11)

    table.cell(infoTable, 0, 0, "üéØ ÌÜµÌï© Ï†ÑÎûµ", text_color=color.white, text_size=size.normal,
              bgcolor=color.new(color.purple, 20))
    table.cell(infoTable, 1, 0, str.tostring(totalScore, "#.#") + "/24Ï†ê", text_color=color.white,
              text_size=size.normal, bgcolor=color.new(color.blue, 20))

    table.cell(infoTable, 0, 1, "ÌòÑÏû¨Í∞Ä", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 1, "$" + str.tostring(close, "#.##"), text_color=color.black, text_size=size.small)

    // Î∂àÏû•Îã®ÌÉÄÏôï
    table.cell(infoTable, 0, 2, "üìä Î∂àÏû•Îã®ÌÉÄÏôï", text_color=color.white, text_size=size.small,
              bgcolor=color.new(color.orange, 30))
    table.cell(infoTable, 1, 2, str.tostring(bulJangScore, "#") + "/10",
              text_color=bulJangScore >= 5 ? color.green : color.gray, text_size=size.small)

    table.cell(infoTable, 0, 3, "VWAP ÌÑ∞Ïπò", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 3, touchingVWAP ? "‚úÖ" : "‚ùå",
              text_color=touchingVWAP ? color.green : color.red, text_size=size.small)

    table.cell(infoTable, 0, 4, "ÌÑ∞ÎãùÌè¨Ïù∏Ìä∏", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 4, turningPoint ? "‚úÖ" : "‚ùå",
              text_color=turningPoint ? color.green : color.red, text_size=size.small)

    table.cell(infoTable, 0, 5, "Ï†ïÎ∞∞Ïó¥", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 5, isUptrend ? "‚úÖ" : "‚ùå",
              text_color=isUptrend ? color.green : color.red, text_size=size.small)

    // ÌÅ¥Î°úÎìú21
    table.cell(infoTable, 0, 6, "üéØ ÌÅ¥Î°úÎìú21", text_color=color.white, text_size=size.small,
              bgcolor=color.new(color.blue, 30))
    table.cell(infoTable, 1, 6, str.tostring(claude21Score, "#") + "/8",
              text_color=claude21Score >= 5 ? color.green : color.gray, text_size=size.small)

    table.cell(infoTable, 0, 7, "15Î∂ÑÎ¥â", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 7, trend_15m_bullish ? "üü¢ BULL" : trend_15m_bearish ? "üî¥ BEAR" : "‚ö™ FLAT",
              text_color=trend_15m_bullish ? color.green : trend_15m_bearish ? color.red : color.gray, text_size=size.small)

    table.cell(infoTable, 0, 8, "5Î∂ÑÎ¥â", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 8, trend_5m_bullish ? "üü¢ BULL" : trend_5m_bearish ? "üî¥ BEAR" : "‚ö™ FLAT",
              text_color=trend_5m_bullish ? color.green : trend_5m_bearish ? color.red : color.gray, text_size=size.small)

    // ÌïÑÌÑ∞
    table.cell(infoTable, 0, 9, "üîç ÌïÑÌÑ∞", text_color=color.white, text_size=size.small,
              bgcolor=color.new(color.green, 30))
    table.cell(infoTable, 1, 9, str.tostring(filterScore, "#") + "/6",
              text_color=filterScore >= 4 ? color.green : color.gray, text_size=size.small)

    table.cell(infoTable, 0, 10, "ÌèâÍ∑†ÌöåÍ∑Ä", text_color=color.black, text_size=size.small)
    table.cell(infoTable, 1, 10, meanReversionOK ? "‚úÖ" : "‚ùå (" + str.tostring(deviation, "#.#") + "%)",
              text_color=meanReversionOK ? color.green : color.red, text_size=size.small)

    table.cell(infoTable, 0, 11, "ÏµúÏ¢Ö Ïã†Ìò∏", text_color=color.black, text_size=size.small)
    string finalSignalText = longSignal_final ? "üöÄ LONG" : shortSignal_final ? "üîª SHORT" : "‚è∏Ô∏è ÎåÄÍ∏∞"
    table.cell(infoTable, 1, 11, finalSignalText,
              text_color=longSignal_final ? color.green : shortSignal_final ? color.red : color.gray,
              text_size=size.small)

// ============================================
// ÏïåÎûå ÏÑ§Ï†ï
// ============================================

if longSignal_final
    string jsonData = '{"signal":"LONG",' +
          '"entry":"' + str.tostring(close, "#.##") + '",' +
          '"totalScore":"' + str.tostring(totalScore, "#.#") + '",' +
          '"bulJangScore":"' + str.tostring(bulJangScore, "#") + '",' +
          '"claude21Score":"' + str.tostring(claude21Score, "#") + '",' +
          '"filterScore":"' + str.tostring(filterScore, "#") + '",' +
          '"tp1":"' + str.tostring(close * (1 + tpPct1/100), "#.##") + '",' +
          '"tp2":"' + str.tostring(close * (1 + tpPct2/100), "#.##") + '",' +
          '"sl":"' + str.tostring(close * (1 - slPct/100), "#.##") + '"}'

    alert(jsonData, freq=alert.freq_once_per_bar)

if shortSignal_final
    string jsonData = '{"signal":"SHORT",' +
          '"entry":"' + str.tostring(close, "#.##") + '",' +
          '"totalScore":"' + str.tostring(totalScore, "#.#") + '",' +
          '"bulJangScore":"' + str.tostring(bulJangScore, "#") + '",' +
          '"claude21Score":"' + str.tostring(claude21Score, "#") + '",' +
          '"filterScore":"' + str.tostring(filterScore, "#") + '",' +
          '"tp1":"' + str.tostring(close * (1 - tpPct1/100), "#.##") + '",' +
          '"tp2":"' + str.tostring(close * (1 - tpPct2/100), "#.##") + '",' +
          '"sl":"' + str.tostring(close * (1 + slPct/100), "#.##") + '"}'

    alert(jsonData, freq=alert.freq_once_per_bar)
