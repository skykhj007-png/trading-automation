# 보조계정 웹훅 URL 재설정 가이드

## 문제 증상
- TradingView 알람은 가는데
- Apps Script 실행 로그에 "Webhook 수신" 없음
- 자동매매 안 됨

---

## 해결 방법: 새 배포 생성

### 1단계: 기존 배포 확인
1. Apps Script 열기
2. 우측 상단 **배포** → **배포 관리** 클릭
3. 활성 배포 URL 확인

### 2단계: 새 배포 생성
1. **배포** → **새 배포** 클릭
2. 설정:
   ```
   유형: 웹 앱
   설명: 보조계정 V27 - 2025-12-21  (날짜 입력)
   실행 권한: 나
   액세스 권한: 모든 사용자  ← 중요!
   ```
3. **배포** 클릭
4. **웹 앱 URL 복사**
   ```
   https://script.google.com/macros/s/AKfycb.../exec
   ```

### 3단계: TradingView 알림 수정
1. TradingView 차트 열기
2. 우측 상단 **알림** (종 아이콘) 클릭
3. 보조계정 알림 찾기 (예: "클로드25 보조계정")
4. **...** → **편집** 클릭
5. 웹훅 URL 칸에 **새 URL 붙여넣기**
6. **저장** 클릭

### 4단계: 웹훅 테스트
브라우저에서 새 웹 앱 URL 접속:
```
https://script.google.com/macros/s/AKfycb.../exec
```

**예상 결과**:
```json
{
  "status": "ok",
  "message": "클로드25 V27 웹훅 서버 작동 중",
  "timestamp": "2025-12-21 ..."
}
```

---

## 웹훅 URL 문제 체크리스트

- [ ] 새 배포 생성 (액세스: "모든 사용자")
- [ ] 웹 앱 URL 복사
- [ ] TradingView 알림 편집
- [ ] 새 URL 붙여넣기
- [ ] 브라우저에서 URL 테스트 ({"status":"ok"} 확인)
- [ ] TradingView에서 신호 대기
- [ ] Apps Script 로그에서 "Webhook 수신" 확인

---

## 주의사항

### ⚠️ 흔한 실수
1. **액세스 권한 잘못 선택**: "나만" 선택하면 웹훅 차단됨
   - ✅ 반드시 "모든 사용자" 선택

2. **URL 잘못 복사**:
   - ❌ 개발 URL (script.google.com/..../dev)
   - ✅ 배포 URL (script.google.com/macros/s/.../exec)

3. **여러 알림 설정**: 메인/보조 계정 URL 혼동
   - 메인: 메인 계정 웹 앱 URL
   - 보조: 보조 계정 웹 앱 URL (각각 다름!)

---

## 빠른 테스트

### TradingView에서 즉시 테스트하려면:
1. 1분봉 차트로 변경
2. 변동성 큰 코인 선택 (BTC, ETH)
3. 신호 발생 대기 (1-5분 이내)
4. Apps Script 로그 확인

### 신호 강제 발생 (Pine Script 설정):
```
지표 설정 → 최소 신호 강도: 8로 낮추기
```

---

## 여전히 안 되면?

1. **Apps Script 로그 확인**:
   ```
   실행 → 실행 로그
   오류 메시지 확인
   ```

2. **TradingView 알림 내역**:
   ```
   알림 → 알림 로그
   웹훅 전송 성공 여부 확인
   ```

3. **배포 권한 재설정**:
   ```
   배포 → 배포 관리 → 기존 배포 삭제
   새 배포 다시 생성
   ```
